<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AquaBot-X Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to right, #0f2027, #203a43, #2c5364);
      color: white;
      text-align: center;
      padding: 20px;
    }
    h1 {
      font-size: 2em;
      margin-bottom: 10px;
    }
    .card {
      background: rgba(255,255,255,0.1);
      padding: 15px;
      margin: 15px auto;
      border-radius: 15px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 0 10px rgba(0,0,0,0.4);
    }
    button {
      padding: 10px 15px;
      margin: 5px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1em;
    }
    .btn-green { background: #2ecc71; color: white; }
    .btn-red { background: #e74c3c; color: white; }
    canvas {
      margin: 15px auto;
      display: block;
    }
  </style>
</head>
<body>
  <h1>🐟 AquaBot-X Control Panel</h1>

  <div class="card">
    <h2>📊 Live Data</h2>
    <p id="gas">Gas: --</p>
    <p id="oil">Oil: --</p>
    <p id="distance">Distance: --</p>
    <p id="battery">Battery: --</p>
  </div>

  <div class="card">
    <h2>⚙️ Controls</h2>
    <button class="btn-green" onclick="sendCommand('feedOn')">Feed Fish</button>
    <button class="btn-red" onclick="sendCommand('feedOff')">Stop Feeding</button><br>
    <button class="btn-green" onclick="sendCommand('pumpOn')">Pump ON</button>
    <button class="btn-red" onclick="sendCommand('pumpOff')">Pump OFF</button>
  </div>

  <div class="card">
    <h2>📈 Charts</h2>
    <canvas id="gasChart" width="300" height="150"></canvas>
    <canvas id="batChart" width="300" height="150"></canvas>
  </div>

  <script>
    let gasChart, batChart;

    async function fetchData() {
      try {
        const res = await fetch("/data");
        const data = await res.json();

        document.getElementById("gas").innerText = "Gas: " + data.gas;
        document.getElementById("oil").innerText = "Oil: " + data.oil;
        document.getElementById("distance").innerText = "Distance: " + data.distance + " cm";
        document.getElementById("battery").innerText = "Battery: " + data.battery + "%";

        updateCharts(data.gas, data.battery);
      } catch (err) {
        console.log("Error fetching data:", err);
      }
    }

    function sendCommand(cmd) {
      fetch("/" + cmd);
    }

    function initCharts() {
      const gasCtx = document.getElementById('gasChart').getContext('2d');
      gasChart = new Chart(gasCtx, {
        type: 'line',
        data: { labels: [], datasets: [{ label: 'Gas Level', data: [], borderColor: '#e74c3c', fill: false }] }
      });

      const batCtx = document.getElementById('batChart').getContext('2d');
      batChart = new Chart(batCtx, {
        type: 'doughnut',
        data: { labels: ['Battery %', 'Remaining'], datasets: [{ data: [0,100], backgroundColor: ['#2ecc71','#555'] }] }
      });
    }

    function updateCharts(gas, battery) {
      const time = new Date().toLocaleTimeString();
      if (gasChart.data.labels.length > 10) gasChart.data.labels.shift();
      if (gasChart.data.datasets[0].data.length > 10) gasChart.data.datasets[0].data.shift();

      gasChart.data.labels.push(time);
      gasChart.data.datasets[0].data.push(gas);
      gasChart.update();

      batChart.data.datasets[0].data = [battery, 100 - battery];
      batChart.update();
    }

    initCharts();
    setInterval(fetchData, 3000);
  </script>
</body>
</html>
